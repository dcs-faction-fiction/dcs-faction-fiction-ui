<html>
<head>
  <style>
    body {
      background-image: url("background.jpg");
      background-repeat: repeat;
    }
  </style>
</head>
<body>
  <script src="const.js"></script>
  <script>

const apiNewToken = API_URL+"/common-api/newjwt"
const queryParams = new URLSearchParams(window.location.search);
const jwt = queryParams.get('jwt');

window.addEventListener('load', e => {
  if (localStorage.token) {
    window.location.replace("select-faction.html");
  } else if (jwt) {
    // This was coming from a link clicked sent via email.
    // Save the token in the localStorage, forward to the faction & campaign selection page.
    localStorage.token = jwt
    // Use location replace so that this URL is not kept in history
    // since it contains the jwt in the url.
    window.location.replace("select-faction.html");
  } else {
    // Ask for the user email
    var email = prompt("Enter your email for login");
    // This url is without parameters to sanitize anything that is already in the query params
    var baseUrl = location.protocol + '//' + location.host + location.pathname;
    // Send the request for a new token to the api
    fetch(apiNewToken, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({email: email, url: window.location+'?jwt='})
    })
    .then(res => alert("Login initiated, check your email for a login link."))
    .catch(err => console.log(err))
  }
});

  </script>
</body>
</html>